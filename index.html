<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chúc Mừng Sinh Nhật</title>
  <style>
    html, body {
      margin: 0; padding: 0; overflow: hidden;
      width: 100vw; height: 100vh; background: #140016;
      font-family: 'Arial', sans-serif;
    }

    canvas {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      z-index: 1;
    }

    #cake {
      position: absolute;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 80px;
      z-index: 2;
      cursor: pointer;
      filter: drop-shadow(0 0 10px #fff);
      transition: transform 0.3s ease;
    }

    #cake:hover {
      transform: translateX(-50%) scale(1.1);
    }

    #videoContainer {
      display: none;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      z-index: 5;
    }

    #videoContainer video {
      max-width: 90vw;
      max-height: 60vh;
      border-radius: 20px;
      box-shadow: 0 0 30px rgba(255, 100, 200, 0.7);
    }

    .message {
      position: absolute;
      color: white;
      font-size: 1.5em;
      font-weight: bold;
      text-shadow: 0 0 8px red, 0 0 12px white;
      animation: floatDown linear forwards;
      z-index: 4;
    }

    @keyframes floatDown {
      0% { transform: translateY(-100px) translateZ(0); opacity: 0; }
      10% { opacity: 1; }
      100% { transform: translateY(100vh) translateZ(-300px); opacity: 0; }
    }
  </style>
</head>
<body>

<audio id="bgm" src="music.mp3" autoplay loop></audio>

<canvas id="canvas"></canvas>
<div id="cake">🎂</div>

<div id="videoContainer">
  <video src="video.mp4" autoplay muted loop playsinline></video>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const points = [];
let mode = "heart"; // or 'text'
let timer = 0;

// === Draw Heart Shape ===
function createHeartShape() {
  points.length = 0;
  for (let t = 0; t < Math.PI * 2; t += 0.1) {
    const x = 16 * Math.pow(Math.sin(t), 3);
    const y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
    points.push({
      x: canvas.width/2 + x * 20,
      y: canvas.height/2 - y * 20,
      dx: (Math.random()-0.5)*5,
      dy: (Math.random()-0.5)*5,
      color: "red",
      alpha: 1
    });
  }
}

// === Convert Text to Pixels ===
function createTextPixels(text, offsetY) {
  const temp = document.createElement("canvas");
  const size = 300;
  temp.width = canvas.width;
  temp.height = size;
  const tctx = temp.getContext("2d");
  tctx.fillStyle = "red";
  tctx.font = "bold 40px Arial";
  tctx.fillText(text, canvas.width/2 - tctx.measureText(text).width/2, 50);
  const data = tctx.getImageData(0, 0, canvas.width, size).data;
  for (let y = 0; y < size; y += 6) {
    for (let x = 0; x < canvas.width; x += 6) {
      const i = (y * canvas.width + x) * 4;
      if (data[i+3] > 128) {
        points.push({ x: x, y: y + offsetY, dx: 0, dy: 0, color: "red", alpha: 1 });
      }
    }
  }
}

// === Animation ===
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (let p of points) {
    ctx.fillStyle = p.color;
    ctx.globalAlpha = p.alpha;
    ctx.beginPath();
    ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
    ctx.fill();
  }
  ctx.globalAlpha = 1;
}

function update() {
  if (mode === "explode") {
    for (let p of points) {
      p.x += p.dx;
      p.y += p.dy;
    }
  }
  draw();
  requestAnimationFrame(update);
}

function explodeToText() {
  points.length = 0;
  createTextPixels("ĐINH THỊ THU HUYỀN", canvas.height/2 - 50);
  createTextPixels("SINH NHẬT TUỔI 24", canvas.height/2 + 20);
}

// === Initialize Heart ===
createHeartShape();
draw();
setTimeout(() => {
  mode = "explode";
  setTimeout(() => {
    mode = "text";
    explodeToText();
  }, 1500);
}, 2000);
update();

// === Handle Cake Click ===
const cake = document.getElementById("cake");
const videoContainer = document.getElementById("videoContainer");
const bgm = document.getElementById("bgm");

cake.addEventListener("click", () => {
  cake.style.display = "none";
  videoContainer.style.display = "block";
  generateMessages();
});

function generateMessages() {
  const messages = [
    "Chúc mừng sinh nhật em 🎂", "Thêm tuổi mới, thêm iu thương 💕",
    "Sinh nhật vui như mơ nhé 🌈", "Anh gửi nghìn cái ôm đến em 🤗",
    "Mỗi năm em đều đáng yêu hơn 😘", "Chúc em thật nhiều bánh kem 🍰",
    "Tuổi mới xinh hơn, vui hơn nha 🌟", "Hạnh phúc là thấy em cười 💖",
    "Chúc em năm nay gặp nhiều phép màu ✨", "Cám ơn vì em đã đến 🎈",
    "Anh chỉ chúc một điều: em mãi hạnh phúc 🥺", "Tuổi mới nhớ yêu bản thân nhiều hơn nha 🧘"
  ];

  function createMessage() {
    const msg = document.createElement("div");
    msg.className = "message";
    msg.innerText = messages[Math.floor(Math.random() * messages.length)];
    msg.style.left = `${Math.random() * 90}vw`;
    msg.style.top = `${-Math.random() * 10}vh`;
    msg.style.fontSize = `${1 + Math.random()}em`;
    msg.style.animationDuration = `${6 + Math.random() * 5}s`;
    document.body.appendChild(msg);
    setTimeout(() => msg.remove(), 12000);
  }

  setInterval(createMessage, 600);
}
</script>

</body>
</html>
