<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chúc Mừng Sinh Nhật Bé Huyền</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background-color: #140016;
      overflow: hidden;
      height: 100vh;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }

    #text-container {
      position: absolute;
      top: 30%;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 2em;
      font-weight: bold;
      text-align: center;
      z-index: 2;
    }

    #cake {
      position: absolute;
      bottom: 10%;
      left: 50%;
      transform: translateX(-50%);
      width: 150px;
      cursor: pointer;
      z-index: 2;
    }

    #main-video {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 90vw;
      max-height: 60vh;
      border-radius: 20px;
      box-shadow: 0 0 30px 5px rgba(255, 100, 200, 0.6);
      display: none;
      z-index: 3;
    }
  </style>
</head>
<body>

<audio id="bgm" src="music.mp3" autoplay loop></audio>
<canvas id="heartCanvas"></canvas>
<div id="text-container" style="display: none;">
  <div id="name-text">ĐINH THỊ THU HUYỀN</div>
  <div id="age-text">SINH NHẬT TUỔI 24</div>
</div>
<img src="cake.png" id="cake" style="display: none;">
<video src="video.mp4" id="main-video" autoplay muted loop playsinline></video>

<script>
const canvas = document.getElementById('heartCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let particles = [];
const total = 800;
const heartFunc = (t) => {
  const x = 16 * Math.pow(Math.sin(t), 3);
  const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
  return [x, y];
};

for (let i = 0; i < total; i++) {
  const t = Math.PI * 2 * Math.random();
  const [x, y] = heartFunc(t);
  particles.push({
    x: canvas.width / 2 + x * 20,
    y: canvas.height / 2 - y * 20,
    dx: (Math.random() - 0.5) * 10,
    dy: (Math.random() - 0.5) * 10,
    radius: 3
  });
}

let state = 'heart';

function drawParticles() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (let p of particles) {
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
    ctx.fillStyle = 'red';
    ctx.fill();
  }
}

function updateParticles() {
  for (let p of particles) {
    p.x += p.dx;
    p.y += p.dy;
  }
}

function formText(text, yOffset, callback) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.font = 'bold 40px sans-serif';
  ctx.fillStyle = 'white';
  ctx.textAlign = 'center';
  ctx.fillText(text, canvas.width / 2, canvas.height / 2 + yOffset);

  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  let count = 0;
  for (let y = 0; y < canvas.height; y += 8) {
    for (let x = 0; x < canvas.width; x += 8) {
      const index = (y * canvas.width + x) * 4;
      if (imageData.data[index + 3] > 128 && count < particles.length) {
        particles[count].tx = x;
        particles[count].ty = y;
        count++;
      }
    }
  }
  for (let i = count; i < particles.length; i++) {
    particles[i].tx = Math.random() * canvas.width;
    particles[i].ty = Math.random() * canvas.height;
  }
  callback();
}

function animateToText() {
  let frames = 0;
  const interval = setInterval(() => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (let p of particles) {
      p.x += (p.tx - p.x) * 0.05;
      p.y += (p.ty - p.y) * 0.05;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
      ctx.fillStyle = 'red';
      ctx.fill();
    }
    frames++;
    if (frames > 60) {
      clearInterval(interval);
      document.getElementById('text-container').style.display = 'block';
      document.getElementById('cake').style.display = 'block';
    }
  }, 30);
}

function animateHeart() {
  let frames = 0;
  const interval = setInterval(() => {
    drawParticles();
    updateParticles();
    frames++;
    if (frames > 60) {
      clearInterval(interval);
      formText('ĐINH THỊ THU HUYỀN', -20, () => {
        formText('SINH NHẬT TUỔI 24', 30, animateToText);
      });
    }
  }, 30);
}

animateHeart();

document.getElementById('cake').addEventListener('click', () => {
  document.getElementById('cake').style.display = 'none';
  document.getElementById('text-container').style.display = 'none';
  document.getElementById('main-video').style.display = 'block';
});
</script>

</body>
</html>
